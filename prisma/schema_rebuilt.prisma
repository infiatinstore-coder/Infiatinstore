generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model users {
  id                String    @id @default(uuid())
  email             String?   @unique
  password_hash     String?
  name              String
  phone             String?   @unique
  role              String    @default("USER")
  avatar_url        String?
  email_verified    DateTime?
  phone_verified    DateTime?
  status            String    @default("ACTIVE")
  google_id         String?
  reset_token       String?
  reset_expires     DateTime?
  last_login        DateTime?
  created_at        DateTime  @default(now())
  updated_at        DateTime  @updatedAt

  orders            orders[]
  reviews           reviews[]
  wishlists         wishlists[]
  addresses         addresses[]
  carts             carts[]
  notifications     notifications[]
  
  // Relations for Fraud & Risk
  user_risk_profiles user_risk_profiles?
  fraud_events       fraud_events[]
}

// ==========================================
// FRAUD MODELS (Included)
// ==========================================

model blacklists {
  id          String    @id @default(uuid())
  type        String    
  value       String    
  reason      String?
  is_active   Boolean   @default(true)
  created_at  DateTime  @default(now())
  expires_at  DateTime?

  @@index([type, value])
}

model user_risk_profiles {
  id                String    @id @default(uuid())
  user_id           String    @unique
  risk_score        Int       @default(0)
  risk_level        String    @default("LOW")
  is_blacklisted    Boolean   @default(false)
  blacklist_reason  String?
  blacklisted_at    DateTime?
  last_login_ip     String?
  last_login_device String?
  updated_at        DateTime  @updatedAt

  user              users     @relation(fields: [user_id], references: [id])
}

model fraud_events {
  id                 String   @id @default(uuid())
  event_type         String 
  event_category     String
  user_id            String?
  order_id           String?
  payment_id         String?
  risk_score         Int
  triggers           Json?
  decision           String
  ip_address         String?
  device_fingerprint String?
  metadata           Json?
  notes              String?
  is_reviewed        Boolean  @default(false)
  reviewed_by        String?
  reviewed_at        DateTime?
  created_at         DateTime @default(now())

  user               users?   @relation(fields: [user_id], references: [id])
}
